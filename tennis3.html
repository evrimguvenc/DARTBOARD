<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="utf-8">
<title>2D Drag-Shot Tennis â€“ v2</title>
<style>
  html,body{margin:0;padding:0;background:#e7f5ee;font-family:sans-serif;
            display:flex;flex-direction:column;align-items:center;overflow:hidden}
  h2{margin:12px 0 4px}
  #scoreboard{display:flex;gap:40px;margin-bottom:8px;text-align:center;font-size:1rem}
  #scoreboard div{min-width:80px}
  /* ------------------ KORT ------------------ */
  #courtContainer{position:relative;overflow:hidden;box-sizing:border-box}
  #court{/* 12 Ã— 24 kare Ä±zgara Ã§izgisi + yeÅŸil zemin */
    width:100%;height:100%;background:#46a15d;
    background-image:
      /* dikey Ã§izgiler */
      repeating-linear-gradient(to right,
        transparent 0 calc((100%/12) - 1px), rgba(0,0,0,.25) calc((100%/12) - 1px) calc(100%/12)),
      /* yatay Ã§izgiler */
      repeating-linear-gradient(to bottom,
        transparent 0 calc((100%/24) - 1px), rgba(0,0,0,.25) calc((100%/24) - 1px) calc(100%/24));
    background-size:100% 100%;
    border:4px solid #0b5c2a;box-sizing:border-box
  }
  /* Kort Ã§izgileri */
  .line{position:absolute;background:#fff;pointer-events:none}
  .hLine{height:2px;width:100%}
  .vLine{width:2px;height:100%}
  /* Top & ok */
  #ball{position:absolute;width:4vmin;height:4vmin;min-width:24px;min-height:24px;
        font-size:3vmin;line-height:4vmin;text-align:center;cursor:grab;user-select:none;
        pointer-events:auto}       /* <-- pointer bug fix */
  #aimLine{position:absolute;width:2px;background:#ff0;transform-origin:0 50%;display:none}
</style>
</head>
<body>
<h2>2D Drag-Shot Tennis</h2>

<div id="scoreboard">
  <div><strong>P1</strong><br>Oyun: <span id="p1G">0</span><br>Puan: <span id="p1P">0</span><br>Rally: <span id="p1R">0</span></div>
  <div><strong>P2</strong><br>Oyun: <span id="p2G">0</span><br>Puan: <span id="p2P">0</span><br>Rally: <span id="p2R">0</span></div>
</div>

<div id="courtContainer">
  <div id="court"></div>
  <div id="aimLine"></div>
  <div id="ball">ðŸŽ¾</div>
</div>

<script>
// ---------- VERÄ° & SABÄ°TLER ----------
const ROWS=24, COLS=12;
const rallyMap=[/* ... Ã¶nceki JSON aynÄ± ... */];
const scoreEl={p1G:el('p1G'),p2G:el('p2G'),p1P:el('p1P'),p2P:el('p2P'),p1R:el('p1R'),p2R:el('p2R')};
let p1G=0,p2G=0,p1P=0,p2P=0,p1R=0,p2R=0;
let server=1,current=1;
const P1=1,P2=2;
const ball=el('ball'),aim=el('aimLine'),court=el('court'),wrap=el('courtContainer');
const friction=0.98,maxPull=150,speedScale=0.05;
updateScore();

// ---------- KORT Ã‡Ä°ZGÄ°LERÄ° yÃ¼zde-konumlu ----------
function drawLines(){
  wrap.querySelectorAll('.line').forEach(l=>l.remove());
  const add=(cls,style)=>{const d=document.createElement('div');d.className=`line ${cls}`;Object.assign(d.style,style);wrap.appendChild(d);}
  const pct=r=>`${(r/ROWS)*100}%`, pctCol=c=>`${(c/COLS)*100}%`;
  add('hLine',{top:pct(0)});             // Ã¼st baseline
  add('hLine',{top:pct(ROWS)});          // alt baseline
  add('vLine',{left:pctCol(0)});         // sol single
  add('vLine',{left:pctCol(COLS)});      // saÄŸ single
  add('hLine',{top:pct(6)});             // servis Ã§izgileri
  add('hLine',{top:pct(ROWS-6)});
  add('vLine',{left:pctCol(COLS/2),top:pct(6),height:`${(ROWS-12)/ROWS*100}%`}); // merkez servis
  add('hLine',{top:pct(ROWS/2)});        // net
}

// ---------- RESPONSIVE ORAN ----------
function resize(){
  const maxW=window.innerWidth*0.9, maxH=window.innerHeight*0.9;
  const w=Math.min(maxW,maxH/2);
  wrap.style.width=w+'px';wrap.style.height=(w*2)+'px';
  drawLines();placeBall();
}
window.addEventListener('resize',resize);resize();

// ---------- TOP MEKANÄ°ÄžÄ° ----------
let startX=0,startY=0,velX=0,velY=0,animFrame=null;
ball.addEventListener('mousedown',e=>{
  startX=e.clientX;startY=e.clientY;aim.style.display='block';document.onmousemove=drag;document.onmouseup=release;
});
function drag(e){
  const dx=e.clientX-startX,dy=e.clientY-startY,len=Math.min(Math.hypot(dx,dy),maxPull),ang=Math.atan2(dy,dx);
  aim.style.width=len+'px';aim.style.transform=`translate(${ball.offsetLeft+ball.clientWidth/2}px,${ball.offsetTop+ball.clientHeight/2}px) rotate(${ang}rad)`;
}
function release(e){
  document.onmousemove=document.onmouseup=null;aim.style.display='none';
  const dx=e.clientX-startX,dy=e.clientY-startY,len=Math.min(Math.hypot(dx,dy),maxPull);
  if(len<5)return;
  const ang=Math.atan2(dy,dx);velX=Math.cos(ang)*len*speedScale;velY=Math.sin(ang)*len*speedScale;
  current=P1;step();                    // atan oyuncu P1 varsayÄ±msal
}
function step(){
  cancelAnimationFrame(animFrame);
  ball.style.left=ball.offsetLeft+velX+'px';
  ball.style.top =ball.offsetTop +velY+'px';
  velX*=friction;velY*=friction;
  if(Math.hypot(velX,velY)>0.1){animFrame=requestAnimationFrame(step);}
  else resolveDrop();
}

// ---------- KONUM & PUAN ----------
function resolveDrop(){
  const rect=court.getBoundingClientRect();
  const cx=ball.offsetLeft+ball.clientWidth/2, cy=ball.offsetTop+ball.clientHeight/2;
  if(cx<rect.left||cx>rect.right||cy<rect.top||cy>rect.bottom){rallyEnd(opp(current));return;}
  const col=Math.floor((cx-rect.left)/(rect.width /COLS));
  const row=Math.floor((cy-rect.top )/(rect.height/ROWS));
  const val=rallyMap[row][col]||0;if(val===0){rallyEnd(opp(current));return;}
  if(current===P1)p1R+=val;else p2R+=val;updateScore();
  if(Math.abs(p1R-p2R)>=3){const w=p1R>p2R?P1:P2;gamePoint(w);p1R=p2R=0;}
  current=opp(current);placeBall();
}
function rallyEnd(w){p1R=p2R=0;gamePoint(w);placeBall();}
function gamePoint(w){
  const next=p=>p===0?15:p===15?30:p===30?40:'g';
  if(w===P1){const n=next(p1P);if(n==='g'){p1G++;p1P=p2P=0;}else p1P=n;}
  else      {const n=next(p2P);if(n==='g'){p2G++;p1P=p2P=0;}else p2P=n;}
  updateScore();
}
function updateScore(){scoreEl.p1G.textContent=p1G;scoreEl.p2G.textContent=p2G;
  scoreEl.p1P.textContent=p1P;scoreEl.p2P.textContent=p2P;
  scoreEl.p1R.textContent=p1R;scoreEl.p2R.textContent=p2R;}
function placeBall(){
  const rect=court.getBoundingClientRect();
  const x=server===P1?rect.left+rect.width*0.25:rect.left+rect.width*0.75;
  const y=server===P1?rect.top+rect.height*0.9:rect.top+rect.height*0.1;
  ball.style.left=(x-ball.clientWidth/2)+'px';ball.style.top=(y-ball.clientHeight/2)+'px';
}
function opp(p){return p===P1?P2:P1;}
function el(id){return document.getElementById(id);}
</script>
</body>
</html>
